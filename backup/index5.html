<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Three.js GLB Viewer â€” Wavy Wall + Mouse/Touch Orbit</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { display: block; }
</style>

<script type="importmap">
{
  "imports": {
    "three": "./three/build/three.module.js"
  }
}
</script>
</head>

<body>
<script type="module">
import * as THREE from './three/build/three.module.js';
import { GLTFLoader } from './three/examples/jsm/loaders/GLTFLoader.js';
import { SimplexNoise } from './three/examples/jsm/math/SimplexNoise.js';

// ---------- Renderer ----------
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x000000);
document.body.appendChild(renderer.domElement);

// ---------- Scene & Camera ----------
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 0, 3);
const target = new THREE.Vector3(0, -.125, 0);

// ---------- Ambient light ----------
const ambient = new THREE.AmbientLight(0x404040, 20);
scene.add(ambient);

// ---------- High-density tiled wall plane ----------
const width = 100;
const height = 100;
const segments = 600; // smooth displacement
const bgGeometry = new THREE.PlaneGeometry(width, height, segments, segments);

const bgTexture = new THREE.TextureLoader().load('background2.jpg', (tex) => {
    tex.wrapS = THREE.RepeatWrapping;
    tex.wrapT = THREE.RepeatWrapping;
    tex.repeat.set(19, 30);
});

const bgMaterial = new THREE.MeshBasicMaterial({ map: bgTexture, side: THREE.DoubleSide });
const bgPlane = new THREE.Mesh(bgGeometry, bgMaterial);
bgPlane.rotation.set(0, 0, 0); // vertical wall
bgPlane.position.set(0, 0, -7.77); // behind the model
scene.add(bgPlane);

// ---------- Simplex noise ----------
const simplex = new SimplexNoise();

// ---------- GLB Loader ----------
const loader = new GLTFLoader();
let model = null;

loader.load('scene.glb', (gltf)=>{
    model = gltf.scene;

    // --- Scale model ---
    const box = new THREE.Box3().setFromObject(model);
    const size = box.getSize(new THREE.Vector3()).length();
    const scale = 2.5 / size;
    model.scale.setScalar(scale);

    // --- Adjust metalness ---
    model.traverse(obj=>{
        if(obj.isMesh && obj.material){
            const mats = Array.isArray(obj.material)?obj.material:[obj.material];
            mats.forEach(m=>{ if('metalness' in m) m.metalness = 0.5; });
        }
    });

    scene.add(model);

    // --- GLB lights ---
    let glbLights = 0;
    model.traverse(child=>{
        if(child.isLight){
            child.intensity *= 0.25;
            console.log('GLB light:', child.type, 'Intensity:', child.intensity);
            glbLights++;
        }
    });
    if(glbLights === 0) console.warn('No lights in GLB!');
});

// ---------- Mouse + Touch parallax ----------
let inputX = 0, inputY = 0; // camera input
const parallaxIntensity = 5;

// Mouse
document.addEventListener('mousemove', e => {
    inputX = (e.clientX/window.innerWidth - 0.5) * 2;
    inputY = (e.clientY/window.innerHeight - 0.5) * 2;
});

// Touch
document.addEventListener('touchstart', e => {
    if(e.touches.length === 1){
        inputX = (e.touches[0].clientX/window.innerWidth - 0.5)*2;
        inputY = (e.touches[0].clientY/window.innerHeight - 0.5)*2;
    }
});
document.addEventListener('touchmove', e => {
    if(e.touches.length === 1){
        inputX = (e.touches[0].clientX/window.innerWidth - 0.5)*2;
        inputY = (e.touches[0].clientY/window.innerHeight - 0.5)*2;
    }
});

// ---------- Resize ----------
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// ---------- Camera orbit ----------
function updateCameraParallax(){
    if(!model) return;

    const radius = camera.position.length();
    const angleY = -inputX * parallaxIntensity * 0.1;
    const angleX = inputY * parallaxIntensity * 0.1;

    const phi = Math.PI/2 - angleX;
    const theta = angleY;

    camera.position.x = radius * Math.sin(phi) * Math.sin(theta);
    camera.position.y = radius * Math.cos(phi);
    camera.position.z = radius * Math.sin(phi) * Math.cos(theta);

    camera.lookAt(target);
}

// ---------- Animate ----------
function animate(){
    requestAnimationFrame(animate);

    // Camera
    updateCameraParallax();

    // Scroll texture diagonally
    bgTexture.offset.x += -0.001;
    bgTexture.offset.y += -0.001;

    // Animate wavy displacement with simplex noise
    const positions = bgGeometry.attributes.position;
    const time = performance.now() * 0.001;
    for(let i=0; i<positions.count; i++){
        const x = positions.getX(i);
        const y = positions.getY(i);
        positions.setZ(i, simplex.noise3d(x*0.18, y*0.18, time*0.3) * 1.4); // true simplex noise
    }
    positions.needsUpdate = true;

    // Render
    renderer.render(scene, camera);
}

animate();
</script>

<!-- Tour Dates Overlay -->
<div id="tour-dates">
  <div id="tour-header">On Tour</div>
  <!-- Close button -->
  <div id="tour-close">&times;</div>
  <div id="tour-list">
    <ul>
      <li><span class="date">2.6 &mdash; </span><a href="https://thebellwetherla.com/events/g-jones-b2b-eprom-260206">The Bellwether</a> &mdash; Los Angeles, CA</li>
      <li><span class="date">2.7 &mdash; </span><a href="https://thebellwetherla.com/events/g-jones-b2b-eprom-260206">Gem & Jam</a> &mdash; Tucson, AZ</li>
      <li><span class="date">3.7 &mdash; </span><a href="">SILO</a> &mdash; Brooklyn, NY</li>
      <li><span class="date">3.20 &mdash; </span><a href="">Venue TBA</a> &mdash; Nashville, TN </li>
      <li><span class="date">3.27 &mdash; </span><a href="">Oxford Arts Factory</a> &mdash; Sydney, AUS </li>
      <li><span class="date">3.28 &mdash; </span><a href="">Villa</a> &mdash; Perth, AUS </li>
      <li><span class="date">4.2 &mdash; </span><a href="">Misfits</a> &mdash; Melbourne, AUS </li>
      <li><span class="date">4.3 &mdash; </span><a href="">Rabbits Eat Lettuce</a> &mdash; Stonelands, AUS </li>
      <li><span class="date">4.4 &mdash; </span><a href="">Mothership</a> &mdash; Auckland, NZ </li>
      <li><span class="date">4.16 &mdash; </span><a href="">Paradiso</a> &mdash; Amsterdam, NL </li>
      <li><span class="date">4.17 &mdash; </span><a href="">Gretchen</a> &mdash; Berlin, DE </li>
      <li><span class="date">4.18 &mdash; </span><a href="">Petit Bain</a> &mdash; Paris, FR </li>
      <li><span class="date">4.23 &mdash; </span><a href="">Sneaky Pete's</a> &mdash; Edinburgh, UK </li>
      <li><span class="date">4.24 &mdash; </span><a href="">Kable</a> &mdash; Manchester, UK </li>
      <li><span class="date">4.25 &mdash; </span><a href="">The Steel Yard</a> &mdash; London, UK </li>
      <li><span class="date">5.31 &mdash; </span><a href="">Illfest</a> &mdash; Austin, TX</li>
    </ul>
  </div>
</div>
<!-- Bottom links -->
<a href="https://stem.ffm.to/disk-utility" target="_blank" id="bottom-music">Music</a>
<a href="https://gjones.store/password" target="_blank" id="bottom-merch">Store</a>

<style>

/* Music centered at bottom */
#bottom-music {
  position: fixed;
  bottom: 20px;          /* same vertical as Tour Dates button */
  left: 50%;             /* center horizontally */
  transform: translateX(-50%);
  background-color: rgba(0,0,0,0.8);
  color: white;
  font-family: 'Futura', sans-serif;
  font-weight: bold;
  font-size: 4rem;
  text-decoration: none;
  padding: 12px 16px;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s ease;
}

#bottom-music:hover {
  background-color: white; color: black;
}

/* Merch right-aligned */
#bottom-merch {
  position: fixed;
  bottom: 20px;          /* same vertical */
  right: 20px;           /* right edge */
  background-color: rgba(0,0,0,0.8);
  color: white;
  font-family: 'Futura', sans-serif;
  font-weight: bold;
  font-size: 4rem;
  text-decoration: none;
  padding: 12px 16px;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s ease;
}

#bottom-merch:hover {
  background-color: white; color: black;
}


#tour-dates {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background-color: rgba(0,0,0,0.8);
  color: white;
  font-family: 'Futura', sans-serif;
  font-weight: bold;
  cursor: pointer;
  padding: 12px 16px;
  z-index: 10;
  transition: all 0.4s ease;
  max-width: 50%;
  overflow: hidden;
}

#tour-dates:hover {
  background-color: white; color: black;
}

#tour-list ul li span.date { width:120px; display: inline-block; }

#tour-close {
    display: none;
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 4rem;
  font-weight: bold;
  cursor: pointer;
  color: white;
  z-index: 11;
}
#tour-close:hover {
  color: #444444; /* optional hover effect */
}

#tour-header {
  font-size: 4rem;
}

#tour-list {
  margin-top: 12px;
  display: none;
  font-weight: normal;
  font-family: 'Futura', sans-serif;
  font-size: 36px;
  /*line-height: 58px;*/
}

#tour-list ul li a { background-color:white; color: black; text-decoration: none; padding: 0px 15px; border-radius: 999px; display: inline-block; margin-top:3px;}

#tour-list ul li a:hover { background-color:black; color: white; padding: 0px 15px; border-radius: 999px; display: inline-block; }

#tour-list ul {
  list-style: none;      /* removes bullets */
  padding: 0;            /* removes default indentation */
  margin: 0;             /* removes default top/bottom margin */
}

#tour-dates.expanded {
    background-color: black; color: white;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 40px;
  border: 20px solid rgba(0,0,0,0.2); /* leaves some Three.js visible */
  border-radius: 0;
  overflow-y: auto;
  max-width: none;
  max-height: none;
  box-sizing: border-box;
}

#tour-dates.expanded #tour-close {
  display: block;           /* show only when overlay is expanded */
}

#tour-dates.expanded #tour-list {
  display: block;
}
</style>

<script>
const tourDiv = document.getElementById('tour-dates');
tourDiv.addEventListener('click', () => {
  tourDiv.classList.toggle('expanded');
});
</script>

</body>
</html>
